<!--
  WANT - A build management tool.                                 
  Copyright (c) 2001-2003 Juancarlo Anez, Caracas, Venezuela.          
  All rights reserved.
  

  This library is free software; you can redistribute it and/or
  modify it under the terms of the GNU Lesser General Public
  License as published by the Free Software Foundation; either
  version 2.1 of the License, or (at your option) any later version.
  
  This library is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
  Lesser General Public License for more details.
  
  You should have received a copy of the GNU Lesser General Public
  License along with this library; if not, write to the Free Software
  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA

{ $Id: want.xml,v 1.83 2004/05/29 17:23:09 juanco Exp $ }

This is the Want script for building Want.
See http://www.suigeneris.org/want/ for details.
-->
<project name="FPUpdater" basedir="." default="release">
	<property name="old.version" value="?{release.ini:releases:current}"/>
	<regexp property="old.build" text="${old.version}" pattern="^.*\.([0-9]+)$" subst="\1"/>
	<property name="build" value="={${old.build}}"/>
	<regexp property="version" text="${old.version}" pattern="\.[0-9]*$" subst=".${build}"/>
	<regexp property="comma.version" pattern="\." subst="," text="${version}"/>
	<regexp property="version2" pattern="^[0-9]*\.[0-9]*" text="${version}"/>
	<tstamp>
		<format property="when" pattern="yyyy,mm,dd,HH,nn,ss"/>
		<format property="date.tag" pattern="yyyy-mm-dd"/>
	</tstamp>
	<property name="basepath" value=""/>
	<regexp property="basepath" text="${basedir}" pattern="^\/" subst=""/>
	<property name="bin" value="${basepath}/bin"/>
	<property name="dcu" value="${basepath}/dcu"/>
	<property name="src" value="${basepath}/src"/>
	<property name="test" value="${basepath}/test"/>
	<property name="setup" value="${basepath}/setup"/>
	<property name="FPUpdater" value="${src}/FPUpdater"/>
	<target name="prepare">
		<mkdir dir="${dcu}"/>
		<mkdir dir="${bin}"/>
		<echo message="version=${version}"/>
		<echo message="build=${build}"/>
		<delete dir="${src}">
			<include name="**/*.dcu"/>
			<include name="**/*.exe"/>
			<include name="**/*.rsm"/>
			<include name="**/*.dsm"/>
			<include name="**/*.log"/>
			<include name="**/*.~*"/>
			<include name="**/*.bak"/>
		</delete>
	</target>
	<target name="clean">
		<delete dir="${dcu}">
			<include name="*.dcu"/>
		</delete>
		<delete dir="${bin}">
			<include name="*.exe"/>
		</delete>
		<delete dir="${basedir}">
			<include name="*.exe"/>
		</delete>
	</target>
	<target name="finalclean">
  </target>
	<!-- ***** Compile FPUpdater ***** -->
	<target name="Compile-FPUpdater" depends="prepare">
		<delete dir="${dcu}">
			<include name="*.dcu"/>
		</delete>
        <exec executable="msbuild.exe">
            <arg value="/clp:ErrorsOnly /t:Build  ${FPUpdater}/FPUpdater.dproj /p:Platform=Win32 /p:Config=Release /p:DCC_ExeOutput=Setup" />
        </exec>
	</target>
	<target name="setup">
		<echo input="${setup}/setup_template.iss" file="${basedir}/setup.iss"/>
		<exec executable="iscc">
			<arg value="Setup.iss"/>
			<arg value="/Q"/>
		</exec>
		<move tofile="${basepath}/FPUpdater_${version2}_${build}.exe">
			<include name="${basepath}/setup.exe"/>
		</move>
		<delete file="${basepath}/setup.iss"/>
	</target>
	<target name="build">
		<ini file="release.ini">
			<write section="releases" key="current" value="${version}"/>
			<write section="releases" key="last_date" value="${date.tag}"/>
		</ini>
	</target>
	<target name="compile" depends="Compile-FPUpdater"/>
	<target name="release" depends="clean,prepare,compile,setup,finalclean"/>
</project>
